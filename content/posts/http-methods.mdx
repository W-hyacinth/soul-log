---
title: "HTTP 메서드"
description: "HTTP API URI 설계 원칙과 GET, POST, PUT, PATCH, DELETE 메서드의 특징 및 속성을 정리합니다."
date: 2022-06-19
tags: ["Network", "HTTP", "모든 개발자를 위한 HTTP 웹 기본 지식"]
cover: null
---

## HTTP API를 만들어보자

예를 들어, 회원 정보 관리 API를 만든다고 가정해보겠습니다.

- 회원 목록 조회
- 회원 조회
- 회원 등록
- 회원 수정
- 회원 삭제

### 설계 과정

1. 요구사항 분석
2. API URI 설계

일반적으로 생각할 수 있는 설계 방식은 다음과 같습니다.

- 회원 목록 조회 `/read-member-list`
- 회원 조회 `/read-member-by-id`
- 회원 등록 `/create-member`
- 회원 수정 `/update-member`
- 회원 삭제 `/delete-member`

하지만 리소스를 중심으로 설계하는 것이 좋습니다.

- 위의 예시에서 등록하고 수정하는 것이 리소스가 아닌, 회원이라는 개념 자체가 리소스입니다. 회원이라는 리소스만 식별하면 됩니다.
- 회원 리소스를 URI에 매핑합니다.
  - 회원 목록 조회 `/members`
  - 회원 조회 `/members/{id}`
  - 회원 등록 `/members/{id}`
  - 회원 수정 `/members/{id}`
  - 회원 삭제 `/members/{id}`
- 계층 구조상 상위를 컬렉션으로 보고 복수단어 사용을 권장합니다.
- 리소스와, 해당 리소스를 대상으로 하는 행위를 분리합니다.
  - 리소스: 회원
  - 행위: 조회, 등록, 수정, 삭제

---

## HTTP 메서드

가장 흔히 사용되는 메서드로는 `GET`, `POST`, `PUT`, `PATCH`, `DELETE`가 있습니다.

### GET

```
GET /members/100 HTTP/1.1
Host: localhost:8080
```

- 리소스를 조회합니다.
- 서버에 전달하고 싶은 데이터는 query를 통해서 전달합니다.
- 메시지 바디를 사용해서 전달할 수 있지만, 지원하지 않는 곳이 많아서 권장하지 않습니다.

### POST

```
POST /members HTTP/1.1
Content-Type: application/json

{
  "username": "young",
  "age": 20
}
```

- 요청 데이터를 처리합니다.
- 메시지 바디를 통해 서버로 요청 데이터를 전달합니다.
- 서버는 요청 데이터를 처리합니다.
  - 메시지 바디를 통해 들어온 데이터를 처리하는 모든 기능을 수행합니다.
- 주로 전달된 데이터로 신규 리소스 등록, 요청 데이터 처리, 다른 메서드로 처리하기 애매한 경우에 사용합니다.
  - 대상 리소스가 리소스의 고유한 의미 체계에 따라 요청에 포함된 표현을 처리하도록 요청합니다. (기본 스펙)
  - 신규 리소스 등록 시에는 상태코드를 201로 보냅니다.
    - `HTTP/1.1 201 Created`
  - 생성된 리소스의 경로를 포함합니다.
- 결론적으로, 리소스 URI에 POST 요청이 오면 요청 데이터를 어떻게 처리할지 리소스마다 따로 정해야 합니다.
  - 새 리소스 생성
    - 서버가 식별하지 않은 새 리소스를 생성합니다.
  - 요청 데이터 처리
    - 단순히 데이터를 생성하거나 변경하는 것을 넘어서 프로세스를 처리해야 하는 경우입니다.
      - 주문에서 결제완료 → 배달시작 → 배달완료처럼 단순히 값 변경을 넘어 프로세스 상태가 변경되는 경우입니다.
    - POST의 결과로 새로운 리소스가 생성되지 않을 수도 있습니다.

      ![POST 컨트롤 URI 예시](/images/http-methods/post-control-uri.png)

  - 다른 메서드로 처리하기 애매한 경우
    - 예) JSON으로 조회 데이터를 넘겨야 하는데, GET 메서드를 사용하기 어려운 경우
    - 애매하면 POST를 사용합니다.

### PUT

```
PUT /members/100 HTTP/1.1
Content-Type: application/json

{
  "username": "hello",
  "age": 20
}
```

- 리소스를 완전히 대체합니다.
  - 만약 필드가 없을 경우 해당 필드도 삭제합니다.
- 리소스가 없으면 생성합니다.
- 클라이언트가 리소스를 식별합니다.
  - 리소스 위치를 알고 URI를 지정합니다.
  - 리소스를 식별한다는 점이 POST와의 차이점입니다.

### PATCH

```
PATCH /members/100 HTTP/1.1
Content-Type: application/json

{
  "age": 50
}
```

- 리소스를 부분 변경합니다.
  - 필드가 없어도 해당하는 필드만 변경합니다.
- 경우에 따라 서버에서 PATCH를 못 받는 경우도 있습니다.
  - 이런 경우에는 POST로 처리합니다.

### DELETE

```
DELETE /members/100 HTTP/1.1
Host: localhost:8080
```

- 리소스를 삭제합니다.

### 기타 메서드

`HEAD`

- GET과 동일하지만 메시지 부분을 제외하고, 상태 줄과 헤더만 반환합니다.

`OPTIONS`

- 대상 리소스에 대한 통신 가능 옵션을 설명합니다. (주로 CORS에서 사용)

`CONNECT`

- 대상 자원으로 식별되는 서버에 대한 터널을 설정합니다.

`TRACE`

- 대상 리소스에 대한 경로를 따라 메시지 루프백 테스트를 수행합니다.

---

## HTTP 메서드의 속성

### 안전 (Safe Methods)

- 호출해도 리소스를 변경하지 않습니다.
- 해당하는 리소스만 고려합니다.
  - 예) `GET`

### 멱등 (Idempotent Methods)

- 한 번 호출하든 두 번 호출하든 100번 호출하든 결과가 똑같습니다.
  - 예) `GET`, `PUT`, `DELETE`
- 멱등은 외부 요인으로 리소스가 변경되는 것까지는 고려하지 않습니다.
- 자동 복구 메커니즘
  - 서버가 TIMEOUT 등으로 정상 응답을 못 주었을 때, 클라이언트가 같은 요청을 다시 해도 되는가가 판단 근거입니다.

### 캐시가능 (Cacheable Methods)

- 응답 결과 리소스를 캐시해서 사용해도 되는지를 나타냅니다.
  - 예) `GET`, `HEAD`, `POST`, `PATCH` 캐시 가능
- 실제로는 `GET`, `HEAD` 정도만 캐시로 사용합니다.
- `POST`나 `PATCH`는 본문 내용까지 캐시 키로 고려할 경우 구현하기 어렵습니다.
